<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* ===== FIREBASE CONFIG ===== */
var firebaseConfig = {
  apiKey: "AIzaSyBpcY72lQEziKJBdMWCgOIxWKLwIWe1Fgw",
  databaseURL: "https://royrohit-294fc-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "royrohit-294fc"
};

/* ===== PREVENT DOUBLE INIT ===== */
if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}

const db = firebase.database();
let reqId = null;

function requestJoin() {
  const name = document.getElementById("name").value.trim();
  if (!name) {
    alert("Please enter your name");
    return;
  }

  db.ref("requests").push({
    name: name,
    status: "pending",
    room: "",
    time: Date.now()
  }).then(ref => {
    reqId = ref.key;
    document.getElementById("status").innerText =
      "⏳ Waiting for admin approval...";
  }).catch(err => {
    alert("Firebase error: " + err.message);
  });

  db.ref("requests").child(reqId).on("value", snap => {
    if (!snap.exists()) return;
    const data = snap.val();

    if (data.status === "approved") {
      window.location.href =
        `chat.html?name=${data.name}&room=${data.room}&id=${reqId}`;
    }

    if (data.status === "rejected") {
      document.getElementById("status").innerText =
        "❌ Request rejected by admin";
    }
  });
}
</script>
