<!DOCTYPE html>
<html>
<head>
  <title>Open Chat – Join</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

<div class="card">
  <h2>Request to Join Chat</h2>
  <input id="name" placeholder="Enter your name">
  <button onclick="requestJoin()">Request Access</button>
  <p id="status"></p>
</div>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyBpcY72lQEziKJBdMWCgOIxWKLwIWe1Fgw",
  databaseURL: "https://royrohit-294fc-default-rtdb.firebaseio.com",
  projectId: "royrohit-294fc"
};
firebase.initializeApp(firebaseConfig);

let reqId;

function requestJoin(){
  const name=document.getElementById("name").value.trim();
  if(!name) return alert("Enter your name");

  reqId=firebase.database().ref("requests").push({
    name:name,
    status:"pending",
    room:"",
    time:Date.now()
  }).key;

  status.innerText="⏳ Waiting for admin approval...";

  firebase.database().ref("requests/"+reqId).on("value",s=>{
    if(!s.exists()) return;
    const d=s.val();
    if(d.status==="approved"){
      location.href=`chat.html?name=${d.name}&room=${d.room}&id=${reqId}`;
    }
    if(d.status==="rejected"){
      status.innerText="❌ Request rejected";
    }
  });
}
</script>

</body>
</html>
