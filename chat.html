<!DOCTYPE html>
<html>
<head>
  <title>Chat Room</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; margin:0; padding:0; background:#f4f4f4 }
    #chat { margin:0 auto; max-width:600px; padding:10px 0 80px 0; }
    .msg-user { font-weight:bold }
    .msg { margin-bottom:10px; background:#fff; padding:10px; border-radius:8px; box-shadow:0 1px 2px #ccc; }
    #msgBar { position:fixed; bottom:0; left:0; width:100%; background:#fff; padding:10px; box-shadow:0 -2px 8px #ccc; }
    #msgBar textarea { width:60%; padding:10px; resize:vertical; min-height:40px; max-height:120px; }
    #msgBar button { padding:10px; margin-left:5px; }
  </style>
</head>
<body>
<div id="chat"></div>
<div id="msgBar">
  <textarea id="msg" placeholder="Type your message... (Shift+Enter for new line)"></textarea>
  <button onclick="send()">Send</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
var firebaseConfig = {
  apiKey: "AIzaSyBpcY72lQEziKJBdMWCgOIxWKLwIWe1Fgw",
  databaseURL: "https://royrohit-294fc-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "royrohit-294fc",
  storageBucket: "royrohit-294fc.appspot.com"
};
firebase.initializeApp(firebaseConfig);

let user = localStorage.getItem("user") || "Guest";
let room = "general";
let chatBox = document.getElementById("chat");

// Listen for new messages
function loadChat() {
  chatBox.innerHTML = "";
  firebase.database().ref("chats/"+room).off();
  firebase.database().ref("chats/"+room).on("child_added", s => {
    let v = s.val();
    let html = `<div class="msg"><span class="msg-user">${v.name || "Anon"}:</span> `;
    if (v.msg) html += v.msg.replace(/\n/g, "<br>");
    html += "</div>";
    chatBox.innerHTML += html;
    window.scrollTo(0, document.body.scrollHeight);
  });
}
loadChat();

// Send message
function send() {
  var text = document.getElementById("msg").value;
  if (!text.trim()) return;
  firebase.database().ref("chats/"+room).push({ msg:text, name: user });
  document.getElementById("msg").value = "";
}

// Enter = send, Shift+Enter = newline
document.getElementById("msg").addEventListener("keydown", function(e) {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    send();
  }
});
</script>
</body>
</html>
