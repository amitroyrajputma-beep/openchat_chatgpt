<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Panel ‚Äì Open Chat</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

<h2>üõ° Admin Approval Panel</h2>
<div id="list"></div>

<script>
/* ================= ADMIN KEY ================= */
const ADMIN_KEY = "ROY_ADMIN_123";

/* ================= SECURITY CHECK ================= */
if (!location.search.includes("key=" + ADMIN_KEY)) {
  document.body.innerHTML = "<h2>‚ùå Access Denied</h2>";
  throw new Error("Unauthorized");
}

/* ================= FIREBASE CONFIG ================= */
var firebaseConfig = {
  apiKey: "AIzaSyBpcY72lQEziKJBdMWCgOIxWKLwIWe1Fgw",
  databaseURL: "https://royrohit-294fc-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "royrohit-294fc"
};

firebase.initializeApp(firebaseConfig);

/* ================= DATABASE ================= */
const db = firebase.database();
const list = document.getElementById("list");

/* ================= LOAD PENDING REQUESTS ================= */
db.ref("requests").on("child_added", snap => {
  const data = snap.val();
  if (data.status !== "pending") return;

  const div = document.createElement("div");
  div.className = "card";
  div.id = snap.key;

  div.innerHTML = `
    <p><b>Name:</b> ${data.name}</p>
    <input id="room_${snap.key}" placeholder="Enter room name">
    <button onclick="approve('${snap.key}')">‚úÖ Approve</button>
    <button onclick="reject('${snap.key}')">‚ùå Reject</button>
  `;

  list.appendChild(div);
});

/* ================= APPROVE ================= */
function approve(id) {
  const room = document.getElementById("room_" + id).value.trim();
  if (!room) {
    alert("Room name is required");
    return;
  }

  db.ref("requests/" + id).update({
    status: "approved",
    room: room
  });

  document.getElementById(id).remove();
}

/* ================= REJECT ================= */
function reject(id) {
  db.ref("requests/" + id).update({
    status: "rejected"
  });

  document.getElementById(id).remove();
}
</script>

</body>
</html>
