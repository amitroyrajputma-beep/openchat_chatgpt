<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background:#111; color:#fff; padding:20px }
    .card { background:#222; padding:15px; margin-bottom:10px; border-radius:8px }
    input, button, select { padding:8px; margin-top:5px }
    button { border:none; cursor:pointer }
    .ok { background:#28a745; color:#fff }
    .no { background:#dc3545; color:#fff }
    .block { background:#ffc107; color:#222 }
    .del { background:#dc3545; color:#fff }
    .room { background:#007bff; color:#fff }
    .userlist, .roomlist { margin-bottom:30px }
    table { width:100%; border-collapse:collapse; }
    th, td { border:1px solid #444; padding:6px; }
  </style>
</head>
<body>
<div id="loginBox">
  <h3>Admin Login</h3>
  <input id="adminPass" type="password" placeholder="Enter admin password">
  <button onclick="checkAdmin()">Login</button>
  <p id="loginMsg"></p>
</div>
<div id="panel" style="display:none">
  <h2>Admin Panel</h2>
  <div class="userlist">
    <h3>Users</h3>
    <table id="usersTable">
      <tr><th>Username</th><th>Status</th><th>Approved</th><th>Blocked</th><th>Actions</th></tr>
    </table>
  </div>
  <div class="roomlist">
    <h3>Rooms</h3>
    <table id="roomsTable">
      <tr><th>Room</th><th>Actions</th></tr>
    </table>
  </div>
</div>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
var firebaseConfig = {
  apiKey: "AIzaSyBpcY72lQEziKJBdMWCgOIxWKLwIWe1Fgw",
  databaseURL: "https://royrohit-294fc-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "royrohit-294fc"
};
firebase.initializeApp(firebaseConfig);

const ADMIN_PASSWORD = "yourStrongPassword"; // CHANGE THIS!

function checkAdmin() {
  var pass = document.getElementById("adminPass").value;
  if (pass === ADMIN_PASSWORD) {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("panel").style.display = "";
    loadPanel();
  } else {
    document.getElementById("loginMsg").innerText = "Wrong password!";
  }
}

function loadPanel() {
  // Users
  firebase.database().ref("users").on("value", snap => {
    var t = document.getElementById("usersTable");
    t.innerHTML = '<tr><th>Username</th><th>Status</th><th>Approved</th><th>Blocked</th><th>Actions</th></tr>';
    snap.forEach(c => {
      var d = c.val();
      var tr = document.createElement("tr");
      tr.innerHTML = `<td>${c.key}</td>
        <td>${d.reg_time ? new Date(d.reg_time).toLocaleString() : ""}</td>
        <td>${d.approved ? "‚úÖ" : "‚ùå"}</td>
        <td>${d.blocked ? "üö´" : ""}</td>
        <td>
          <button class="ok" onclick="approveUser('${c.key}')">Approve</button>
          <button class="block" onclick="blockUser('${c.key}',${!d.blocked})">${d.blocked ? "Unblock" : "Block"}</button>
        </td>`;
      t.appendChild(tr);
    });
  });
  // Rooms
  firebase.database().ref("rooms").on("value", snap => {
    var t = document.getElementById("roomsTable");
    t.innerHTML = '<tr><th>Room</th><th>Actions</th></tr>';
    snap.forEach(c => {
      var tr = document.createElement("tr");
      tr.innerHTML = `<td>${c.key}</td>
        <td><button class="del" onclick="deleteRoom('${c.key}')">Delete</button></td>`;
      t.appendChild(tr);
    });
  });
}

function approveUser(user) {
  firebase.database().ref("users/"+user).update({ approved:true, blocked:false });
}
function blockUser(user, block) {
  firebase.database().ref("users/"+user).update({ blocked:block });
}
function deleteRoom(room) {
  if (confirm("Delete room "+room+"?")) {
    firebase.database().ref("rooms/"+room).remove();
    firebase.database().ref("chats/"+room).remove();
  }
}
</script>
</body>
</html>
